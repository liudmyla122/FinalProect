{
    "sourceFile": "backend/src/scripts/seedCommenters.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1769702452193,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1769702452193,
            "name": "Commit-0",
            "content": "\nconst mongoose = require('mongoose');\nconst bcrypt = require('bcrypt');\nrequire('dotenv').config();\n\nconst User = require('../models/userModel');\nconst Post = require('../models/postModel');\nconst connectDB = require('../config/db');\n\n\nconst AVATAR_PHOTOS = [\n  'https://i.pravatar.cc/200?u=anna_photo',\n  'https://i.pravatar.cc/200?u=max_creates',\n  'https://i.pravatar.cc/200?u=sophie_travel',\n  'https://i.pravatar.cc/200?u=daniel_dev',\n  'https://i.pravatar.cc/200?u=olivia_art',\n];\n\n\nconst PLACEHOLDER_POST_IMAGE =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg==';\n\n\nconst COMMENTERS = [\n  {\n    email: 'anna.k@example.com',\n    username: 'anna_photo',\n    fullName: 'Anna Kozak',\n    password: 'password123',\n    avatar: AVATAR_PHOTOS[0],\n    bio: 'Photography lover üì∑',\n  },\n  {\n    email: 'max.t@example.com',\n    username: 'max_creates',\n    fullName: 'Max Thompson',\n    password: 'password123',\n    avatar: AVATAR_PHOTOS[1],\n    bio: 'Creator & designer ‚ú®',\n  },\n  {\n    email: 'sophie.m@example.com',\n    username: 'sophie_travel',\n    fullName: 'Sophie Martin',\n    password: 'password123',\n    avatar: AVATAR_PHOTOS[2],\n    bio: 'Travel & nature üåø',\n  },\n  {\n    email: 'daniel.r@example.com',\n    username: 'daniel_dev',\n    fullName: 'Daniel Rivera',\n    password: 'password123',\n    avatar: AVATAR_PHOTOS[3],\n    bio: 'Developer & coffee ‚òï',\n  },\n  {\n    email: 'olivia.s@example.com',\n    username: 'olivia_art',\n    fullName: 'Olivia Smith',\n    password: 'password123',\n    avatar: AVATAR_PHOTOS[4],\n    bio: 'Art and music üé®',\n  },\n];\n\n\nconst COMMENT_TEXTS = [\n  'So beautiful! Love it! üåø',\n  'Amazing shot! Nature is the best.',\n  'This is so peaceful. Needed this today.',\n  'Stunning! Where is this place?',\n  'Incredible mood. Great post!',\n];\n\n\nconst OWNER_POST_CAPTIONS = [\n  'Silence, fresh air, and a sense of harmony. Nature knows how to remind us how little is needed for happiness. üåø',\n  'New day, new perspective. ‚ú®',\n];\n\n\nconst COMMENTER_POST_CAPTIONS = [\n  'Sunset vibes today üì∑',\n  'Working on something new ‚ú®',\n  'Travel mood üåø',\n  'Code and coffee ‚òï',\n  'Art studio day üé®',\n];\n\nasync function seedCommenters() {\n  try {\n    await connectDB();\n\n    const ownerKey =\n      process.env.OWNER_USERNAME ||\n      process.env.OWNER_EMAIL ||\n      process.argv[2] ||\n      'liudmyla';\n    const ownerQuery = {\n      $or: [\n        { username: new RegExp(`^${ownerKey}$`, 'i') },\n        { email: new RegExp(`^${ownerKey}$`, 'i') },\n      ],\n    };\n\n    let owner = await User.findOne(ownerQuery);\n    if (!owner) {\n      const postOwnerIds = await Post.distinct('user');\n      owner = postOwnerIds.length\n        ? await User.findOne({ _id: { $in: postOwnerIds } })\n        : null;\n      if (owner) {\n        console.log(\n          '\\n‚ö†Ô∏è  –ü–æ –∫–ª—é—á—É \"' + ownerKey + '\" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ—Å—Ç–∞–º–∏:',\n          owner.username,\n          '\\n'\n        );\n      } else {\n        console.log(\n          '\\n‚ö†Ô∏è  –í –ë–î –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:\\n   node src/scripts/seedCommenters.js –≤–∞—à_username\\n'\n        );\n        process.exit(1);\n      }\n    }\n\n    console.log('\\nüë§ –í–ª–∞–¥–µ–ª–µ—Ü –ø–æ—Å—Ç–æ–≤:', owner.username, `(${owner.email})\\n`);\n\n    console.log('üë• –°–æ–∑–¥–∞–Ω–∏–µ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π-–∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–æ–≤...');\n    const createdUsers = [];\n\n    for (const data of COMMENTERS) {\n      let user = await User.findOne({\n        $or: [{ email: data.email }, { username: data.username }],\n      });\n      if (user) {\n        const hadPlaceholder = !user.avatar || user.avatar.startsWith('data:image/png;base64,iVBORw0KGgo');\n        if (hadPlaceholder && data.avatar) {\n          user.avatar = data.avatar;\n          await user.save();\n          console.log('   ‚úì –ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω (—Ñ–æ—Ç–æ):', user.username);\n        } else {\n          console.log('   ‚úì –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å:', user.username);\n        }\n        createdUsers.push(user);\n        continue;\n      }\n\n      const salt = await bcrypt.genSalt(10);\n      const hashedPassword = await bcrypt.hash(data.password, salt);\n      user = new User({\n        email: data.email,\n        username: data.username,\n        fullName: data.fullName,\n        password: hashedPassword,\n        avatar: data.avatar || '',\n        bio: data.bio || '',\n      });\n      await user.save();\n      createdUsers.push(user);\n      console.log('   ‚úì –°–æ–∑–¥–∞–Ω (—Å —Ñ–æ—Ç–æ –∞–≤–∞—Ç–∞—Ä–∞):', user.username);\n    }\n\n    if (createdUsers.length === 0) {\n      console.log('   –í—Å–µ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.\\n');\n    }\n\n    let myPosts = await Post.find({ user: owner._id }).lean();\n\n    if (myPosts.length === 0) {\n      console.log('\\nüì∏ –£ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ ‚Äî —Å–æ–∑–¥–∞—ë–º –ø–æ—Å—Ç—ã –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞...');\n      for (let i = 0; i < OWNER_POST_CAPTIONS.length; i++) {\n        const post = new Post({\n          user: owner._id,\n          image: PLACEHOLDER_POST_IMAGE,\n          images: [PLACEHOLDER_POST_IMAGE],\n          caption: OWNER_POST_CAPTIONS[i],\n          isVideo: false,\n        });\n        await post.save();\n        const ownerDoc = await User.findById(owner._id);\n        if (ownerDoc && Array.isArray(ownerDoc.posts)) {\n          ownerDoc.posts.push(post._id);\n          await ownerDoc.save();\n        }\n        console.log('   ‚úì –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω:', OWNER_POST_CAPTIONS[i].slice(0, 40) + '...');\n      }\n      myPosts = await Post.find({ user: owner._id }).lean();\n    }\n\n    console.log('\\nüì∏ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ —É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (5 –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–æ–≤)...');\n    for (let i = 0; i < createdUsers.length; i++) {\n      const user = createdUsers[i];\n      const existing = await Post.findOne({ user: user._id });\n      if (existing) {\n        console.log('   ‚úì –£ @' + user.username + ' —É–∂–µ –µ—Å—Ç—å –ø–æ—Å—Ç—ã.');\n        continue;\n      }\n      const caption = COMMENTER_POST_CAPTIONS[i % COMMENTER_POST_CAPTIONS.length];\n      const post = new Post({\n        user: user._id,\n        image: PLACEHOLDER_POST_IMAGE,\n        images: [PLACEHOLDER_POST_IMAGE],\n        caption,\n        isVideo: false,\n      });\n      await post.save();\n      const userDoc = await User.findById(user._id);\n      if (userDoc && Array.isArray(userDoc.posts)) {\n        userDoc.posts.push(post._id);\n        await userDoc.save();\n      }\n      console.log('   ‚úì –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è @' + user.username);\n    }\n\n    console.log('\\nüí¨ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞...');\n    let addedCount = 0;\n\n    for (const post of myPosts) {\n      const postDoc = await Post.findById(post._id);\n      if (!postDoc) continue;\n\n      for (let i = 0; i < createdUsers.length; i++) {\n        const commenter = createdUsers[i];\n        const text = COMMENT_TEXTS[i % COMMENT_TEXTS.length];\n        const alreadyCommented = (postDoc.comments || []).some(\n          (c) => c.user && String(c.user) === String(commenter._id)\n        );\n        if (alreadyCommented) continue;\n\n        postDoc.comments.push({\n          user: commenter._id,\n          text,\n        });\n        addedCount++;\n      }\n      await postDoc.save();\n    }\n\n    console.log(`   ‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: ${addedCount}`);\n    console.log('\\nüéâ –ì–æ—Ç–æ–≤–æ!');\n    console.log('\\nüìã –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–æ–≤ (–ø–∞—Ä–æ–ª—å —É –≤—Å–µ—Ö: password123):');\n    COMMENTERS.forEach((c) => {\n      console.log(`   - @${c.username} (${c.email})`);\n    });\n    console.log('');\n\n    process.exit(0);\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞:', error);\n    process.exit(1);\n  }\n}\n\nseedCommenters();\n"
        }
    ]
}