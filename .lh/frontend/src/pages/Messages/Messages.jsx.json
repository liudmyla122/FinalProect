{
    "sourceFile": "frontend/src/pages/Messages/Messages.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1769704220041,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770821794880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -190,9 +190,9 @@\n       <div className=\"app-layout-main messages-page-content\">\n         <div className=\"messages-layout\">\n         <aside className=\"messages-chats-list\">\n           <div className=\"messages-chats-header\">\n-            <h2 className=\"messages-chats-title\">itcareerhub</h2>\n+            <h2 className=\"messages-chats-title\">{user?.organization || 'Messages'}</h2>\n             {user && (\n               <div className=\"messages-chats-my-account\">\n                 {myDisplayAvatar && !myDisplayAvatarIsVideo && !myAvatarFailed ? (\n                   <img\n@@ -414,4 +414,5 @@\n   )\n }\n \n export default Messages\n+\n"
                },
                {
                    "date": 1770828734424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,9 @@\n   const [myAvatarFailed, setMyAvatarFailed] = useState(false)\n   const [selectedChat, setSelectedChat] = useState(null)\n   const [newMessageText, setNewMessageText] = useState('')\n \n-  // Get organization from localStorage (synced from Profile page) or user's own organization\n+  \n   const currentViewedOrg = localStorage.getItem('currentViewedOrganization')\n   const displayOrg = currentViewedOrg || user?.organization || 'Messages'\n \n   const [chats, setChats] = useState([\n"
                }
            ],
            "date": 1769704220041,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { authAPI } from '../../services/api';\nimport { useCreatePost } from '../../context/CreatePostContext';\nimport './Messages.css';\n\nconst Messages = () => {\n  const navigate = useNavigate();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [selectedChat, setSelectedChat] = useState(null);\n  const [newMessageText, setNewMessageText] = useState('');\n  const { open: openCreateModal } = useCreatePost();\n\n  \n  const [chats, setChats] = useState([\n    {\n      id: 1,\n      username: 'nikiita',\n      fullName: 'nikiita',\n      avatar: 'https://i.pravatar.cc/150?img=12',\n      lastMessage: 'Nikiita sent a message.',\n      timestamp: '2 wek',\n      messages: [\n        {\n          id: 1,\n          sender: 'nikiita',\n          text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.',\n          timestamp: 'Jun 26, 2024, 08:49 PM',\n          isOwn: false,\n        },\n        {\n          id: 2,\n          sender: 'me',\n          text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.',\n          timestamp: 'Jun 26, 2024, 08:50 PM',\n          isOwn: true,\n        },\n      ],\n    },\n    {\n      id: 2,\n      username: 'sashaa',\n      fullName: 'sashaa',\n      avatar: 'https://i.pravatar.cc/150?img=47',\n      lastMessage: 'Sashaa sent a message.',\n      timestamp: '2 wek',\n      messages: [],\n    },\n  ]);\n\n  useEffect(() => {\n    document.title = 'Messages - ICHGRAM';\n    \n    const token = localStorage.getItem('token');\n    if (!token) {\n      navigate('/login');\n      return;\n    }\n\n    const fetchUser = async () => {\n      try {\n        const response = await authAPI.getCurrentUser();\n        setUser(response.user);\n      } catch (error) {\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        navigate('/login');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchUser();\n  }, [navigate]);\n\n  useEffect(() => {\n    \n    if (chats.length > 0 && !selectedChat) {\n      setSelectedChat(chats[0]);\n    }\n  }, [chats, selectedChat]);\n\n  const handleSendMessage = () => {\n    if (!selectedChat || !newMessageText.trim()) return;\n\n    const newMessage = {\n      id: Date.now(),\n      sender: user?.username || 'me',\n      text: newMessageText.trim(),\n      timestamp: new Date().toLocaleString('en-US', {\n        month: 'short',\n        day: '2-digit',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n      }),\n      isOwn: true,\n    };\n\n    setChats((prevChats) =>\n      prevChats.map((chat) =>\n        chat.id === selectedChat.id\n          ? {\n              ...chat,\n              lastMessage: newMessage.text,\n              messages: [...chat.messages, newMessage],\n            }\n          : chat\n      )\n    );\n\n    setSelectedChat((prev) =>\n      prev\n        ? {\n            ...prev,\n            lastMessage: newMessage.text,\n            messages: [...prev.messages, newMessage],\n          }\n        : prev\n    );\n\n    setNewMessageText('');\n  };\n\n  if (loading) {\n    return <div className=\"messages-loading\">Загрузка...</div>;\n  }\n\n  return (\n    <div className=\"messages-container\">\n      <div className=\"messages-layout\">\n        {}\n        <aside className=\"messages-sidebar\">\n          <div className=\"messages-sidebar-logo\">ICHGRAM</div>\n          <nav className=\"messages-sidebar-nav\">\n            <Link to=\"/\" className=\"messages-nav-item\">\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n                <polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n              </svg>\n              <span>Home</span>\n            </Link>\n            <Link to=\"/search\" className=\"messages-nav-item\">\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n                <path d=\"m21 21-4.35-4.35\"></path>\n              </svg>\n              <span>Search</span>\n            </Link>\n            <Link to=\"/explore\" className=\"messages-nav-item\">\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <polygon points=\"12 2 2 7 12 12 22 7 12 2\"></polygon>\n                <polyline points=\"2 17 12 22 22 17\"></polyline>\n                <polyline points=\"2 12 12 17 22 12\"></polyline>\n              </svg>\n              <span>Explore</span>\n            </Link>\n            <Link to=\"/messages\" className=\"messages-nav-item active\">\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n                <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\n              </svg>\n              <span>Messages</span>\n            </Link>\n            <Link to=\"/notifications\" className=\"messages-nav-item\">\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\n              </svg>\n              <span>Notifications</span>\n            </Link>\n            <button\n              className=\"messages-nav-item\"\n              type=\"button\"\n              onClick={openCreateModal}\n              style={{ background: 'none', border: 'none', width: '100%', textAlign: 'left', cursor: 'pointer' }}\n            >\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n                <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"></line>\n                <line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"></line>\n              </svg>\n              <span>Create</span>\n            </button>\n            <Link to=\"/profile\" className=\"messages-nav-item\">\n              <svg className=\"messages-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n                <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n              </svg>\n              <span>Profile</span>\n            </Link>\n          </nav>\n          \n          {}\n          <div className=\"messages-letters-animation\">\n            {Array.from({ length: 20 }, (_, i) => {\n              const messageLetters = 'MESSAGES';\n              const allLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n              \n              const letter = i % 3 === 0 \n                ? messageLetters[Math.floor(Math.random() * messageLetters.length)]\n                : allLetters[Math.floor(Math.random() * allLetters.length)];\n              return (\n                <span\n                  key={i}\n                  className=\"messages-floating-letter\"\n                  style={{\n                    left: `${Math.random() * 75 + 10}%`,\n                    animationDelay: `${Math.random() * 8}s`,\n                    animationDuration: `${12 + Math.random() * 8}s`,\n                    fontSize: `${18 + Math.random() * 10}px`,\n                  }}\n                >\n                  {letter}\n                </span>\n              );\n            })}\n          </div>\n        </aside>\n\n        {}\n        <aside className=\"messages-chats-list\">\n          <div className=\"messages-chats-header\">\n            <h2 className=\"messages-chats-title\">itcareerhub</h2>\n          </div>\n          <div className=\"messages-chats-items\">\n            {chats.map((chat) => (\n              <div\n                key={chat.id}\n                className={`messages-chat-item ${selectedChat?.id === chat.id ? 'active' : ''}`}\n                onClick={() => setSelectedChat(chat)}\n              >\n                <img \n                  src={chat.avatar} \n                  alt={chat.username}\n                  className=\"messages-chat-avatar\"\n                  onError={(e) => {\n                    e.target.src = 'https://i.pravatar.cc/150?img=1';\n                  }}\n                />\n                <div className=\"messages-chat-info\">\n                  <div className=\"messages-chat-username\">{chat.username}</div>\n                  <div className=\"messages-chat-preview\">{chat.lastMessage}</div>\n                </div>\n                <div className=\"messages-chat-timestamp\">{chat.timestamp}</div>\n              </div>\n            ))}\n          </div>\n        </aside>\n\n        {}\n        <main className=\"messages-chat-view\">\n          {selectedChat ? (\n            <>\n              {}\n              <header className=\"messages-chat-header\">\n                <div className=\"messages-chat-header-user\">\n                  <img \n                    src={selectedChat.avatar} \n                    alt={selectedChat.username}\n                    className=\"messages-chat-header-avatar\"\n                    onError={(e) => {\n                      e.target.src = 'https://i.pravatar.cc/150?img=1';\n                    }}\n                  />\n                  <span className=\"messages-chat-header-username\">{selectedChat.username}</span>\n                </div>\n              </header>\n\n              {}\n              <div className=\"messages-profile-card\">\n                <img \n                  src={selectedChat.avatar} \n                  alt={selectedChat.username}\n                  className=\"messages-profile-avatar\"\n                  onError={(e) => {\n                    e.target.src = 'https://i.pravatar.cc/150?img=1';\n                  }}\n                />\n                <div className=\"messages-profile-name\">{selectedChat.username}</div>\n                <div className=\"messages-profile-subtitle\">{selectedChat.username} · ICHgram</div>\n                <button className=\"messages-profile-button\">View profile</button>\n              </div>\n\n              {}\n              {selectedChat.messages.length > 0 && (\n                <div className=\"messages-timestamp\">\n                  {selectedChat.messages[0].timestamp}\n                </div>\n              )}\n\n              {}\n              <div className=\"messages-messages-list\">\n                {selectedChat.messages.length > 0 ? (\n                  selectedChat.messages.map((message) => (\n                    <div\n                      key={message.id}\n                      className={`messages-message ${message.isOwn ? 'own' : ''}`}\n                    >\n                      {!message.isOwn && (\n                        <img \n                          src={selectedChat.avatar} \n                          alt={message.sender}\n                          className=\"messages-message-avatar\"\n                          onError={(e) => {\n                            e.target.src = 'https://i.pravatar.cc/150?img=1';\n                          }}\n                        />\n                      )}\n                      <div className=\"messages-message-bubble\">\n                        {message.text}\n                      </div>\n                      {message.isOwn && (\n                        <div className=\"messages-message-icon\">ICH</div>\n                      )}\n                    </div>\n                  ))\n                ) : (\n                  <div className=\"messages-empty\">Нет сообщений</div>\n                )}\n              </div>\n\n              {}\n              <div className=\"messages-input-container\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Write message\"\n                  className=\"messages-input\"\n                  value={newMessageText}\n                  onChange={(e) => setNewMessageText(e.target.value)}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter') {\n                      e.preventDefault();\n                      handleSendMessage();\n                    }\n                  }}\n                />\n                <button\n                  className=\"messages-send-button\"\n                  type=\"button\"\n                  onClick={handleSendMessage}\n                  disabled={!newMessageText.trim()}\n                >\n                  <svg className=\"messages-send-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                    <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n                    <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\n                  </svg>\n                </button>\n              </div>\n            </>\n          ) : (\n            <div className=\"messages-no-chat\">Выберите чат для начала переписки</div>\n          )}\n        </main>\n      </div>\n\n      {}\n      <footer className=\"messages-footer\">\n        <nav className=\"messages-footer-nav\">\n          <Link to=\"/\">Home</Link>\n          <Link to=\"/search\">Search</Link>\n          <Link to=\"/explore\">Explore</Link>\n          <Link to=\"/messages\">Messages</Link>\n          <Link to=\"/notifications\">Notificaitons</Link>\n          <Link to=\"/create\">Create</Link>\n        </nav>\n        <div className=\"messages-footer-copyright\">© 2026 ICHgram</div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Messages;\n"
        }
    ]
}