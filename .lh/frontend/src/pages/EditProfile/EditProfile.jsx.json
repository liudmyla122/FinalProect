{
    "sourceFile": "frontend/src/pages/EditProfile/EditProfile.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1769703228126,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770727785095,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -297,9 +297,16 @@\n           const avatar =\n             p.id === activeId\n               ? avatarData || ''\n               : fromServer?.avatar ?? p.avatar ?? ''\n-          return { ...p, avatar }\n+          \n+          // Fix: Explicitly send avatarType to server\n+          const type = \n+             p.id === activeId \n+               ? updated.avatarType || (avatar.startsWith('data:video/') ? 'video' : 'image')\n+               : fromServer?.avatarType ?? p.avatarType ?? 'image'\n+\n+          return { ...p, avatar, avatarType: type }\n         })\n \n         const response = await authAPI.updateProfiles(profilesForServer, organization.trim())\n         if (response && response.success !== false) {\n"
                },
                {
                    "date": 1770727953268,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,9 +106,9 @@\n             isVideo: avatar.startsWith('data:video/'),\n           },\n         )\n \n-        const avatarResponse = await authAPI.updateAvatar(avatar)\n+        const avatarResponse = await authAPI.updateAvatar(avatar, avatarType)\n \n         console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ updateAvatar –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', {\n           hasResponse: !!avatarResponse,\n           hasUser: !!avatarResponse?.user,\n"
                }
            ],
            "date": 1769703228126,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from 'react';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport { useCreatePost } from '../../context/CreatePostContext';\nimport { authAPI } from '../../services/api';\nimport { setUserToLocalStorage } from '../../utils/storage';\nimport './EditProfile.css';\n\nconst EditProfile = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const isNewProfile = location.state?.mode === 'create';\n  const { open: openCreateModal } = useCreatePost();\n  const [user, setUser] = useState(null);\n  const [username, setUsername] = useState('');\n  const [website, setWebsite] = useState('');\n  const [about, setAbout] = useState('');\n  const [avatar, setAvatar] = useState(null);\n  const [avatarFile, setAvatarFile] = useState(null);\n  const [avatarType, setAvatarType] = useState('image'); \n  const [saving, setSaving] = useState(false);\n  const [saveError, setSaveError] = useState('');\n\n  useEffect(() => {\n    document.title = isNewProfile ? 'Create new profile - ICHGRAM' : 'Edit profile - ICHGRAM';\n    const stored = localStorage.getItem('user');\n    const activeId = localStorage.getItem('activeProfileId');\n    if (stored) {\n      try {\n        const u = JSON.parse(stored);\n        setUser(u);\n        setUsername(u.username || '');\n        setWebsite(u.website || '');\n        setAbout(u.about || '');\n        let avatarToSet = u.avatar || u.profile_image || '';\n        if (!avatarToSet && activeId) {\n          try {\n            avatarToSet = localStorage.getItem(`profile_avatar_${activeId}`) || '';\n          } catch (_) {}\n        }\n        if (avatarToSet) {\n          setAvatar(avatarToSet);\n          setAvatarType(u.avatarType || (avatarToSet.startsWith?.('data:video/') ? 'video' : 'image'));\n        }\n      } catch {\n        \n      }\n    }\n  }, [isNewProfile]);\n\n  const handleAvatarChange = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    setAvatarFile(file);\n    const isVideo = file.type.startsWith('video/');\n    setAvatarType(isVideo ? 'video' : 'image');\n\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setAvatar(reader.result); \n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleSave = async (e) => {\n    e.preventDefault();\n    \n    if (saving) return; \n    \n    setSaving(true);\n    setSaveError('');\n    \n    \n    if (!username || !username.trim()) {\n      setSaveError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ username');\n      setSaving(false);\n      return;\n    }\n\n    \n    let finalAvatar = avatar || (user && (user.avatar || user.profile_image)) || '';\n    let finalAvatarType = avatarType || (user && user.avatarType) || 'image';\n    \n    \n    if (avatar && typeof avatar === 'string' && avatar.trim().length > 0) {\n      try {\n        console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', {\n          hasAvatar: !!avatar,\n          avatarLength: avatar.length,\n          avatarType: avatarType,\n          avatarPreview: avatar.substring(0, 50),\n          isVideo: avatar.startsWith('data:video/')\n        });\n        \n        const avatarResponse = await authAPI.updateAvatar(avatar);\n        \n        console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ updateAvatar –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', {\n          hasResponse: !!avatarResponse,\n          hasUser: !!avatarResponse?.user,\n          hasAvatar: !!avatarResponse?.user?.avatar,\n          avatarType: avatarResponse?.user?.avatarType,\n          avatarLength: avatarResponse?.user?.avatar?.length || 0\n        });\n        \n        if (avatarResponse && avatarResponse.user && avatarResponse.user.avatar) {\n          finalAvatar = avatarResponse.user.avatar;\n          finalAvatarType = avatarResponse.user.avatarType || avatarType || 'image';\n          console.log('‚úÖ –ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', {\n            avatarType: finalAvatarType,\n            isVideo: finalAvatarType === 'video'\n          });\n        } else {\n          console.warn('‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª –∞–≤–∞—Ç–∞—Ä –≤ –æ—Ç–≤–µ—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π');\n        }\n      } catch (avatarError) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:', avatarError);\n        \n        console.warn('–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –∞–≤–∞—Ç–∞—Ä–æ–º, –Ω–æ –æ–Ω –º–æ–∂–µ—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');\n      }\n    } else {\n      console.log('‚ÑπÔ∏è –ê–≤–∞—Ç–∞—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö');\n    }\n\n    const updated = {\n      ...(user || {}),\n      username: username.trim(),\n      website: website.trim(),\n      about: about.trim(),\n      avatar: finalAvatar,\n      avatarType: finalAvatarType, \n      profileCompleted: true,\n    };\n    \n   \n    try {\n      let profilesRaw;\n      try {\n        profilesRaw = localStorage.getItem('profiles');\n      } catch (localError) {\n        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ localStorage:', localError);\n        setSaveError('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.');\n        setSaving(false);\n        return;\n      }\n\n      let list = [];\n      if (profilesRaw) {\n        try {\n          list = JSON.parse(profilesRaw) || [];\n          if (!Array.isArray(list)) {\n            list = [];\n          }\n        } catch (parseError) {\n          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ profiles:', parseError);\n          list = [];\n        }\n      }\n\n      let activeId = updated.id || localStorage.getItem('activeProfileId');\n      if (!activeId) {\n        activeId = `profile-${Date.now()}`;\n      }\n      \n      \n      const avatarData = updated.avatar;\n      const profileWithoutAvatar = {\n        ...updated,\n        avatar: '', \n        id: activeId,\n      };\n      \n      \n      if (avatarData) {\n        try {\n          localStorage.setItem(`profile_avatar_${activeId}`, avatarData);\n        } catch (avatarError) {\n          console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –æ—Ç–¥–µ–ª—å–Ω–æ:', avatarError);\n          \n        }\n      }\n\n      const exists = list.some((p) => p.id === activeId);\n      const newList = exists\n        ? list.map((p) => (p.id === activeId ? profileWithoutAvatar : p))\n        : [...list, profileWithoutAvatar];\n\n      \n      try {\n       \n        const profilesString = JSON.stringify(newList);\n        const profilesSizeKB = new Blob([profilesString]).size / 1024;\n        \n        if (profilesSizeKB > 4000) { \n          console.warn(`‚ö†Ô∏è –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –±–æ–ª—å—à–æ–π: ${profilesSizeKB.toFixed(2)} KB`);\n        }\n        \n        localStorage.setItem('profiles', profilesString);\n        localStorage.setItem('activeProfileId', activeId);\n        \n        \n        const userWithAvatar = { ...profileWithoutAvatar, avatar: avatarData };\n        setUserToLocalStorage(userWithAvatar);\n        \n        console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ localStorage:', {\n          username: profileWithoutAvatar.username,\n          id: activeId,\n          profilesCount: newList.length,\n          profilesSizeKB: profilesSizeKB.toFixed(2)\n        });\n      } catch (localError) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ localStorage:', localError);\n        \n        \n        if (localError.name === 'QuotaExceededError') {\n          try {\n            \n            const keysToRemove = [];\n            for (let i = 0; i < localStorage.length; i++) {\n              const key = localStorage.key(i);\n              if (key && key.startsWith('profile_avatar_')) {\n                keysToRemove.push(key);\n              }\n            }\n            keysToRemove.forEach(key => localStorage.removeItem(key));\n            console.log(`–û—á–∏—â–µ–Ω–æ ${keysToRemove.length} —Å—Ç–∞—Ä—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤`);\n            \n            \n            const profilesWithoutAvatars = newList.map(p => ({ ...p, avatar: '' }));\n            localStorage.setItem('profiles', JSON.stringify(profilesWithoutAvatars));\n            localStorage.setItem('activeProfileId', activeId);\n            setUserToLocalStorage({ ...profileWithoutAvatar, avatar: avatarData });\n            \n            console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö');\n          } catch (retryError) {\n            console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥–∞–∂–µ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', retryError);\n            setSaveError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–∞–π—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä.');\n            setSaving(false);\n            return;\n          }\n        } else {\n          setSaveError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.');\n          setSaving(false);\n          return;\n        }\n      }\n\n      \n      let serverError = false;\n      let serverErrorMessage = '';\n      try {\n        let serverProfiles = [];\n        try {\n          const currentUserRes = await authAPI.getCurrentUser();\n          serverProfiles = currentUserRes?.user?.profiles || [];\n        } catch (_) {  }\n\n        const profilesForServer = newList.map((p) => {\n          const fromServer = serverProfiles.find((s) => s && String(s.id) === String(p.id));\n          const avatar =\n            p.id === activeId ? (avatarData || '') : (fromServer?.avatar ?? p.avatar ?? '');\n          return { ...p, avatar };\n        });\n\n        const response = await authAPI.updateProfiles(profilesForServer);\n        if (response && response.success !== false) {\n          console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');\n        } else {\n          serverError = true;\n          serverErrorMessage = response?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';\n          console.warn('‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', response);\n        }\n      } catch (err) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', err);\n        serverError = true;\n        serverErrorMessage = err.response?.data?.message || err.message || '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏';\n        \n      }\n      \n      \n      const savedProfiles = localStorage.getItem('profiles');\n      const savedUser = localStorage.getItem('user');\n      const savedActiveId = localStorage.getItem('activeProfileId');\n      \n      if (!savedProfiles || !savedUser || !savedActiveId) {\n        console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ localStorage');\n        setSaveError('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');\n        setSaving(false);\n        return;\n      }\n\n      \n      try {\n        const parsedUser = JSON.parse(savedUser);\n        if (!parsedUser.profileCompleted) {\n          console.warn('‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω, –Ω–æ profileCompleted –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º...');\n          parsedUser.profileCompleted = true;\n          setUserToLocalStorage(parsedUser);\n          \n          \n          const parsedProfiles = JSON.parse(savedProfiles);\n          const updatedProfiles = parsedProfiles.map((p) =>\n            p.id === savedActiveId ? { ...p, profileCompleted: true } : p\n          );\n          localStorage.setItem('profiles', JSON.stringify(updatedProfiles));\n        }\n      } catch (parseError) {\n        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', parseError);\n      }\n      \n      \n      setSaving(false);\n      console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è...');\n      \n      \n      window.location.href = '/profile';\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);\n      const errorMessage = error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';\n      setSaveError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è: ${errorMessage}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`);\n      setSaving(false);\n      \n    }\n  };\n\n  const handleDeleteProfile = async () => {\n    if (!window.confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å? –ï–≥–æ –¥–∞–Ω–Ω—ã–µ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ —ç—Ç–æ–º –ø—Ä–æ—Ñ–∏–ª–µ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è.')) {\n      return;\n    }\n\n    try {\n      const profilesRaw = localStorage.getItem('profiles');\n      let list = [];\n      if (profilesRaw) {\n        try {\n          list = JSON.parse(profilesRaw) || [];\n        } catch {\n          list = [];\n        }\n      }\n\n      const activeId = localStorage.getItem('activeProfileId');\n      const filtered = activeId ? list.filter((p) => p.id !== activeId) : list;\n\n      if (filtered.length > 0) {\n        const newActive = filtered[0];\n        localStorage.setItem('profiles', JSON.stringify(filtered));\n        localStorage.setItem('activeProfileId', newActive.id);\n        setUserToLocalStorage(newActive);\n        try {\n          await authAPI.updateProfiles(filtered);\n        } catch (err) {\n          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', err);\n        }\n        navigate('/profile');\n      } else {\n        \n        localStorage.setItem('profiles', JSON.stringify([]));\n        localStorage.removeItem('activeProfileId');\n        try {\n          await authAPI.updateProfiles([]);\n        } catch (err) {\n          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', err);\n        }\n        navigate('/profile/edit');\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);\n    }\n  };\n\n  return (\n    <div className=\"edit-profile-page\">\n      <aside className=\"profile-sidebar\">\n        <div className=\"sidebar-logo\">ICHGRAM</div>\n        <nav className=\"sidebar-nav\">\n          <Link to=\"/\" className=\"nav-item\">\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n                <polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n              </svg>\n            </div>\n            <span>Home</span>\n          </Link>\n          <Link to=\"/search\" className=\"nav-item\">\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n                <path d=\"m21 21-4.35-4.35\"></path>\n              </svg>\n            </div>\n            <span>Search</span>\n          </Link>\n          <Link to=\"/explore\" className=\"nav-item\">\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <polygon points=\"12 2 2 7 12 12 22 7 12 2\"></polygon>\n                <polyline points=\"2 17 12 22 22 17\"></polyline>\n                <polyline points=\"2 12 12 17 22 12\"></polyline>\n              </svg>\n            </div>\n            <span>Explore</span>\n          </Link>\n          <Link to=\"/messages\" className=\"nav-item\">\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n              </svg>\n            </div>\n            <span>Messages</span>\n          </Link>\n          <Link to=\"/notifications\" className=\"nav-item\">\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\n              </svg>\n            </div>\n            <span>Notifications</span>\n          </Link>\n          <button\n            type=\"button\"\n            className=\"nav-item\"\n            onClick={openCreateModal}\n            style={{ background: 'none', border: 'none', width: '100%', textAlign: 'left', cursor: 'pointer' }}\n          >\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n                <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"></line>\n                <line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"></line>\n              </svg>\n            </div>\n            <span>Create</span>\n          </button>\n          <Link to=\"/profile\" className=\"nav-item active\">\n            <div className=\"nav-icon-placeholder\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n                <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n              </svg>\n            </div>\n            <span>Profile</span>\n          </Link>\n        </nav>\n      </aside>\n\n      <main className=\"edit-profile-main\">\n        <header className=\"edit-profile-header\">\n          <h1>{isNewProfile ? 'Create new profile' : 'Edit profile'}</h1>\n        </header>\n\n        <section className=\"edit-profile-content\">\n          <div className=\"edit-profile-card\">\n            <div className=\"edit-profile-avatar-row\">\n              <div className=\"edit-profile-avatar-circle\">\n                {avatar ? (\n                  avatarType === 'video' ? (\n                    <video\n                      src={avatar}\n                      className=\"edit-profile-avatar-video\"\n                      autoPlay\n                      loop\n                      muted\n                      playsInline\n                    />\n                  ) : (\n                    <img\n                      src={avatar}\n                      alt=\"Profile\"\n                      className=\"edit-profile-avatar-image\"\n                    />\n                  )\n                ) : (\n                  <span className=\"edit-profile-avatar-text\">\n                    {(user?.username || 'IC').slice(0, 2).toUpperCase()}\n                  </span>\n                )}\n              </div>\n              <div className=\"edit-profile-name-block\">\n                <div className=\"edit-profile-name\">\n                  {user?.username || 'your_username'}\n                </div>\n                <div className=\"edit-profile-subtitle\">\n                  ‚Ä¢ {isNewProfile ? '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª—è ICHgram'}\n                </div>\n              </div>\n              <button\n                type=\"button\"\n                className=\"edit-profile-newphoto-btn\"\n                onClick={() => {\n                  const input = document.getElementById('edit-profile-avatar-upload');\n                  if (input) input.click();\n                }}\n              >\n                New photo\n              </button>\n              <input\n                id=\"edit-profile-avatar-upload\"\n                type=\"file\"\n                accept=\"image/*,video/mp4\"\n                onChange={handleAvatarChange}\n                style={{ display: 'none' }}\n              />\n            </div>\n\n            <form className=\"edit-profile-form\" onSubmit={handleSave}>\n              <label className=\"edit-profile-field\">\n                <span className=\"edit-profile-label\">Username</span>\n                <input\n                  type=\"text\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  className=\"edit-profile-input\"\n                  required\n                />\n              </label>\n\n              <label className=\"edit-profile-field\">\n                <span className=\"edit-profile-label\">Website</span>\n                <input\n                  type=\"text\"\n                  value={website}\n                  onChange={(e) => setWebsite(e.target.value)}\n                  className=\"edit-profile-input\"\n                  placeholder=\"https://\"\n                />\n              </label>\n\n              <label className=\"edit-profile-field\">\n                <span className=\"edit-profile-label\">About</span>\n                <textarea\n                  value={about}\n                  onChange={(e) => setAbout(e.target.value)}\n                  className=\"edit-profile-textarea\"\n                  maxLength={1500}\n                  rows={4}\n                />\n                <div className=\"edit-profile-counter\">\n                  {about.length} / 1500\n                </div>\n              </label>\n\n              {saveError && (\n                <div className=\"edit-profile-error\" style={{ color: '#ed4956', marginTop: '8px', fontSize: '14px' }}>\n                  {saveError}\n                </div>\n              )}\n              <div className=\"edit-profile-actions\">\n                <button type=\"submit\" className=\"edit-profile-save-btn\" disabled={saving}>\n                  {saving ? 'Saving...' : 'Save'}\n                </button>\n                <button\n                  type=\"button\"\n                  className=\"edit-profile-delete-btn\"\n                  onClick={handleDeleteProfile}\n                  disabled={saving}\n                >\n                  Delete profile\n                </button>\n              </div>\n            </form>\n          </div>\n        </section>\n\n        <footer className=\"profile-footer\">\n          <nav className=\"footer-nav\">\n            <Link to=\"/\">Home</Link>\n            <Link to=\"/search\">Search</Link>\n            <Link to=\"/explore\">Explore</Link>\n            <Link to=\"/messages\">Messages</Link>\n            <Link to=\"/notifications\">Notifications</Link>\n            <Link to=\"/create\">Create</Link>\n          </nav>\n          <div className=\"footer-copyright\">¬© 2026 ICHgram</div>\n        </footer>\n      </main>\n    </div>\n  );\n};\n\nexport default EditProfile;\n\n"
        }
    ]
}