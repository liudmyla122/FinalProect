{
    "sourceFile": "frontend/src/components/AppSidebar/AppSidebar.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1769785303033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1769785357489,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -187,16 +187,28 @@\n               <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\n             </>,\n           ),\n         )}\n-        {nav(\n-          '/notifications',\n-          'notifications',\n-          'Notifications',\n-          icon(\n+        <button\n+          key=\"notifications\"\n+          type=\"button\"\n+          className={`app-sidebar-nav-item${isNotificationsOpen ? ' active' : ''}`}\n+          onClick={openNotifications}\n+          style={{\n+            background: 'none',\n+            border: 'none',\n+            width: '100%',\n+            textAlign: 'left',\n+            cursor: 'pointer',\n+            font: 'inherit',\n+            color: 'inherit',\n+          }}\n+        >\n+          {icon(\n             <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>,\n-          ),\n-        )}\n+          )}\n+          <span>Notifications</span>\n+        </button>\n         {nav(\n           null,\n           'create',\n           'Create',\n"
                },
                {
                    "date": 1769785470194,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,13 +8,23 @@\n import './AppSidebar.css'\n \n const AppSidebar = ({ activeItem = 'home' }) => {\n   const { open: openCreateModal } = useCreatePost()\n-  const { isOpen: isSearchOpen, openSearch } = useSearchPanel()\n-  const { isOpen: isNotificationsOpen, openNotifications } = useNotifications()\n+  const { isOpen: isSearchOpen, openSearch, closeSearch } = useSearchPanel()\n+  const { isOpen: isNotificationsOpen, openNotifications, closeNotifications } = useNotifications()\n   const [serverAvatar, setServerAvatar] = useState(null)\n   const [serverAvatarIsVideo, setServerAvatarIsVideo] = useState(false)\n \n+  const handleOpenSearch = () => {\n+    closeNotifications()\n+    openSearch()\n+  }\n+\n+  const handleOpenNotifications = () => {\n+    closeSearch()\n+    openNotifications()\n+  }\n+\n   const user = (() => {\n     try {\n       const u = localStorage.getItem('user')\n       return u ? JSON.parse(u) : null\n"
                }
            ],
            "date": 1769785303033,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport { useCreatePost } from '../../context/CreatePostContext'\nimport { useSearchPanel } from '../../context/SearchPanelContext'\nimport { useNotifications } from '../../context/NotificationsContext'\nimport { authAPI } from '../../services/api'\nimport { setProfileAvatarSafe } from '../../utils/storage'\nimport './AppSidebar.css'\n\nconst AppSidebar = ({ activeItem = 'home' }) => {\n  const { open: openCreateModal } = useCreatePost()\n  const { isOpen: isSearchOpen, openSearch } = useSearchPanel()\n  const { isOpen: isNotificationsOpen, openNotifications } = useNotifications()\n  const [serverAvatar, setServerAvatar] = useState(null)\n  const [serverAvatarIsVideo, setServerAvatarIsVideo] = useState(false)\n\n  const user = (() => {\n    try {\n      const u = localStorage.getItem('user')\n      return u ? JSON.parse(u) : null\n    } catch {\n      return null\n    }\n  })()\n\n  useEffect(() => {\n    if (!user) return\n    let cancelled = false\n    authAPI.getCurrentUser().then((res) => {\n      if (cancelled || !res?.user) return\n      const avatar = res.user.avatar && typeof res.user.avatar === 'string' ? res.user.avatar : null\n      if (avatar) {\n        setServerAvatar(avatar)\n        setServerAvatarIsVideo(avatar.startsWith('data:video'))\n        const id = res.user.id || res.user._id\n        if (id) setProfileAvatarSafe(id, avatar)\n      }\n    }).catch(() => {})\n    return () => { cancelled = true }\n  }, [user?.id])\n\n  const sidebarAvatar = (() => {\n    if (serverAvatar) return serverAvatar\n    if (!user) return null\n    const fromUser = user.avatar && typeof user.avatar === 'string' ? user.avatar : null\n    if (fromUser) return fromUser\n    const id = user.id || user._id\n    if (id) {\n      try {\n        const fromStorage = localStorage.getItem(`profile_avatar_${id}`)\n        if (fromStorage && typeof fromStorage === 'string') return fromStorage\n      } catch (_) {}\n    }\n    return null\n  })()\n  const sidebarAvatarIsVideo = serverAvatar ? serverAvatarIsVideo : (sidebarAvatar && typeof sidebarAvatar === 'string' && sidebarAvatar.startsWith('data:video'))\n\n  const nav = (to, key, label, icon, isButton = false) => {\n    const active = activeItem === key\n    const className = `app-sidebar-nav-item${active ? ' active' : ''}`\n    const content = (\n      <>\n        {icon}\n        <span>{label}</span>\n      </>\n    )\n    if (isButton) {\n      return (\n        <button\n          key={key}\n          type=\"button\"\n          className={className}\n          onClick={() => openCreateModal()}\n          style={{ background: 'none', border: 'none', width: '100%', textAlign: 'left', cursor: 'pointer', font: 'inherit', color: 'inherit' }}\n        >\n          {content}\n        </button>\n      )\n    }\n    return (\n      <Link key={key} to={to} className={className}>\n        {content}\n      </Link>\n    )\n  }\n\n  const icon = (children) => (\n    <svg className=\"app-sidebar-nav-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      {children}\n    </svg>\n  )\n\n  return (\n    <aside className=\"app-sidebar\">\n      <div className=\"app-sidebar-logo\">ICHGRAM</div>\n      <nav className=\"app-sidebar-nav\">\n        {nav('/', 'home', 'Home', icon(<><path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path><polyline points=\"9 22 9 12 15 12 15 22\"></polyline></>))}\n        <button\n          key=\"search\"\n          type=\"button\"\n          className={`app-sidebar-nav-item${isSearchOpen ? ' active' : ''}`}\n          onClick={openSearch}\n          style={{ background: 'none', border: 'none', width: '100%', textAlign: 'left', cursor: 'pointer', font: 'inherit', color: 'inherit' }}\n        >\n          {icon(<><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><path d=\"m21 21-4.35-4.35\"></path></>)}\n          <span>Search</span>\n        </button>\n        {nav('/explore', 'explore', 'Explore', icon(<><polygon points=\"12 2 2 7 12 12 22 7 12 2\"></polygon><polyline points=\"2 17 12 22 22 17\"></polyline><polyline points=\"2 12 12 17 22 12\"></polyline></>))}\n        {nav('/saved', 'saved', 'Saved', icon(<path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"></path>))}\n        {nav('/messages', 'messages', 'Messages', icon(<><line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line><polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon></>))}\n        {nav('/notifications', 'notifications', 'Notifications', icon(<path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>))}\n        {nav(null, 'create', 'Create', icon(<><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"></line><line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"></line></>), true)}\n        {nav('/profile', 'profile', 'Profile', icon(<><path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path><circle cx=\"12\" cy=\"7\" r=\"4\"></circle></>))}\n      </nav>\n      {user && (\n        <Link to=\"/profile\" className=\"app-sidebar-current-user\">\n          <div className=\"app-sidebar-current-avatar\">\n            {sidebarAvatar && !sidebarAvatarIsVideo ? (\n              <img src={sidebarAvatar} alt={user.username || 'avatar'} />\n            ) : sidebarAvatar && sidebarAvatarIsVideo ? (\n              <video src={sidebarAvatar} className=\"app-sidebar-current-avatar-video\" autoPlay loop muted playsInline />\n            ) : (\n              <span className=\"app-sidebar-current-initial\">\n                {(user.username || 'U').charAt(0).toUpperCase()}\n              </span>\n            )}\n          </div>\n          <div className=\"app-sidebar-current-info\">\n            <span className=\"app-sidebar-current-name\">\n              {user.fullName || (user.username || '').replace(/^@/, '') || 'Пользователь'}\n            </span>\n            <span className=\"app-sidebar-current-username\">{user.username || ''}</span>\n          </div>\n        </Link>\n      )}\n      <div className=\"app-sidebar-bubbles\">\n        <div className=\"app-sidebar-bubble app-sidebar-bubble-1\"></div>\n        <div className=\"app-sidebar-bubble app-sidebar-bubble-2\"></div>\n        <div className=\"app-sidebar-bubble app-sidebar-bubble-3\"></div>\n        <div className=\"app-sidebar-bubble app-sidebar-bubble-4\"></div>\n        <div className=\"app-sidebar-bubble app-sidebar-bubble-5\"></div>\n        <div className=\"app-sidebar-bubble app-sidebar-bubble-6\"></div>\n      </div>\n    </aside>\n  )\n}\n\nexport default AppSidebar\n"
        }
    ]
}