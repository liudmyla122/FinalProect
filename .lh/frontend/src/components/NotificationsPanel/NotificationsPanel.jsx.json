{
    "sourceFile": "frontend/src/components/NotificationsPanel/NotificationsPanel.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1769786036675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1769786835532,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,84 +1,78 @@\n import { useEffect, useState } from 'react'\n import { useNotifications } from '../../context/NotificationsContext'\n import { usePostModal } from '../../context/PostModalContext'\n-import { usersAPI, exploreAPI } from '../../services/api'\n+import { notificationsAPI } from '../../services/api'\n import './NotificationsPanel.css'\n \n export default function NotificationsPanel() {\n   const { isOpen, closeNotifications } = useNotifications()\n   const { openPostModal } = usePostModal()\n   const [notifications, setNotifications] = useState([])\n+  const [loading, setLoading] = useState(false)\n \n   useEffect(() => {\n     if (isOpen) {\n-      Promise.all([\n-        usersAPI.getSuggestedUsers(),\n-        exploreAPI.getExplorePosts(10) // Fetch some random posts\n-      ])\n-        .then(([usersRes, postsRes]) => {\n-          if (usersRes.success && usersRes.users && postsRes.success && postsRes.posts) {\n-            const users = usersRes.users.slice(0, 3)\n-            const posts = postsRes.posts\n-            \n-            const generatedNotifications = users.map((user, index) => {\n-              const type =\n-                index === 0 ? 'like' : index === 1 ? 'comment' : 'follow'\n-              const text =\n-                type === 'like'\n-                  ? 'liked your photo.'\n-                  : type === 'comment'\n-                    ? 'commented your photo.'\n-                    : 'started following.'\n-              const time =\n-                type === 'like' ? '2 d' : type === 'comment' ? '2 w' : '2 d'\n+      setLoading(true)\n+      notificationsAPI\n+        .getNotifications()\n+        .then((res) => {\n+          if (res.success && res.notifications) {\n+            const formatted = res.notifications.map((n) => {\n+              let text = ''\n+              if (n.type === 'like') text = 'liked your photo.'\n+              else if (n.type === 'comment')\n+                text = n.commentText\n+                  ? `commented: \"${n.commentText}\"`\n+                  : 'commented your photo.'\n+              else if (n.type === 'follow') text = 'started following.'\n \n-              // Use real post data if available, cycling through fetched posts\n-              const linkedPost = posts.length > 0 ? posts[index % posts.length] : null\n-              const postImage = linkedPost \n-                ? (linkedPost.images?.[0] || linkedPost.image) \n-                : `https://picsum.photos/200/200?random=${index}`\n+              const postImage = n.post\n+                ? n.post.images?.[0] || n.post.image\n+                : null\n \n               return {\n-                id: user.id,\n-                type,\n+                id: n._id,\n+                type: n.type,\n                 user: {\n-                  username: user.username,\n+                  username: n.sender?.username || 'Unknown',\n                   avatar:\n-                    user.avatar ||\n-                    `https://ui-avatars.com/api/?name=${user.username}&background=random`,\n+                    n.sender?.avatar ||\n+                    `https://ui-avatars.com/api/?name=${\n+                      n.sender?.username || 'U'\n+                    }&background=random`,\n                 },\n                 text,\n-                time,\n-                postImage: type !== 'follow' ? postImage : null,\n-                postId: linkedPost?.id, // Link the real post ID\n-                isNew: true,\n+                time: formatTime(n.createdAt),\n+                postImage,\n+                postId: n.post?._id,\n+                createdAt: new Date(n.createdAt),\n               }\n             })\n-            setNotifications(generatedNotifications)\n+            setNotifications(formatted)\n           }\n         })\n         .catch((err) => {\n           console.error('Failed to load notifications data', err)\n         })\n+        .finally(() => setLoading(false))\n     }\n   }, [isOpen])\n \n   if (!isOpen) return null\n \n-  const newNotifications = notifications.filter((n) => n.isNew)\n-  const earlierNotifications = notifications.filter((n) => !n.isNew)\n+  // Split by time: last 24h = New, older = Earlier\n+  const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000)\n+  const newNotifications = notifications.filter((n) => n.createdAt > oneDayAgo)\n+  const earlierNotifications = notifications.filter(\n+    (n) => n.createdAt <= oneDayAgo\n+  )\n \n   const handleNotificationClick = (notification) => {\n     if (notification.type === 'follow') {\n       // Navigate to profile (not implemented yet for this click)\n     } else if (notification.postId) {\n       openPostModal(notification.postId)\n-      // We don't close notifications panel to allow user to browse, or we can close it?\n-      // Usually clicking a notification closes the panel or overlays it.\n-      // Since PostModal is z-index 1001 and panel is overlay, it should be fine.\n-      // But maybe better to close sidebar panel?\n-      // closeNotifications() \n     }\n   }\n \n   return (\n@@ -93,9 +87,15 @@\n           <h2 className=\"notifications-panel-title\">Notifications</h2>\n         </div>\n \n         <div className=\"notifications-panel-content\">\n-          {newNotifications.length > 0 && (\n+          {loading && (\n+            <div style={{ padding: '20px', textAlign: 'center' }}>\n+              Loading...\n+            </div>\n+          )}\n+\n+          {!loading && newNotifications.length > 0 && (\n             <>\n               <h3 className=\"notifications-section-title\">New</h3>\n               <div className=\"notifications-list\">\n                 {newNotifications.map((notification) => (\n@@ -108,9 +108,9 @@\n               </div>\n             </>\n           )}\n \n-          {earlierNotifications.length > 0 && (\n+          {!loading && earlierNotifications.length > 0 && (\n             <>\n               <h3 className=\"notifications-section-title\">Earlier</h3>\n               <div className=\"notifications-list\">\n                 {earlierNotifications.map((notification) => (\n@@ -123,21 +123,38 @@\n               </div>\n             </>\n           )}\n \n-          {notifications.length === 0 && (\n+          {!loading && notifications.length === 0 && (\n             <div\n               style={{ padding: '20px', textAlign: 'center', color: '#8e8e8e' }}\n             >\n-              No new notifications\n+              No notifications yet\n             </div>\n           )}\n         </div>\n       </div>\n     </>\n   )\n }\n \n+function formatTime(dateString) {\n+  if (!dateString) return ''\n+  const date = new Date(dateString)\n+  const now = new Date()\n+  const diffInSeconds = Math.floor((now - date) / 1000)\n+\n+  if (diffInSeconds < 60) return `${Math.max(0, diffInSeconds)}s`\n+  const diffInMinutes = Math.floor(diffInSeconds / 60)\n+  if (diffInMinutes < 60) return `${diffInMinutes}m`\n+  const diffInHours = Math.floor(diffInMinutes / 60)\n+  if (diffInHours < 24) return `${diffInHours}h`\n+  const diffInDays = Math.floor(diffInHours / 24)\n+  if (diffInDays < 7) return `${diffInDays}d`\n+  const diffInWeeks = Math.floor(diffInDays / 7)\n+  return `${diffInWeeks}w`\n+}\n+\n function NotificationItem({ notification, onClick }) {\n   return (\n     <div className=\"notification-item\" onClick={onClick} style={{ cursor: 'pointer' }}>\n       <div className=\"notification-avatar-container\">\n"
                },
                {
                    "date": 1770829064422,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -59,18 +59,18 @@\n   }, [isOpen])\n \n   if (!isOpen) return null\n \n-  // Split by time: last 24h = New, older = Earlier\n+  \n   const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000)\n   const newNotifications = notifications.filter((n) => n.createdAt > oneDayAgo)\n   const earlierNotifications = notifications.filter(\n     (n) => n.createdAt <= oneDayAgo\n   )\n \n   const handleNotificationClick = (notification) => {\n     if (notification.type === 'follow') {\n-      // Navigate to profile (not implemented yet for this click)\n+\n     } else if (notification.postId) {\n       openPostModal(notification.postId)\n     }\n   }\n"
                }
            ],
            "date": 1769786036675,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from 'react'\nimport { useNotifications } from '../../context/NotificationsContext'\nimport { usersAPI } from '../../services/api'\nimport './NotificationsPanel.css'\n\nexport default function NotificationsPanel() {\n  const { isOpen, closeNotifications } = useNotifications()\n  const [notifications, setNotifications] = useState([])\n\n  useEffect(() => {\n    if (isOpen) {\n      usersAPI.getSuggestedUsers().then((res) => {\n        if (res.success && res.users) {\n          // Take up to 3 users\n          const users = res.users.slice(0, 3)\n          const generatedNotifications = users.map((user, index) => {\n            const type = index === 0 ? 'like' : index === 1 ? 'comment' : 'follow'\n            const text =\n              type === 'like'\n                ? 'liked your photo.'\n                : type === 'comment'\n                ? 'commented your photo.'\n                : 'started following.'\n            const time =\n              type === 'like' ? '2 d' : type === 'comment' ? '2 w' : '2 d'\n\n            return {\n              id: user.id,\n              type,\n              user: {\n                username: user.username,\n                avatar:\n                  user.avatar ||\n                  `https://ui-avatars.com/api/?name=${user.username}&background=random`,\n              },\n              text,\n              time,\n              postImage:\n                type !== 'follow'\n                  ? `https://picsum.photos/200/200?random=${index}`\n                  : null,\n              isNew: true,\n            }\n          })\n          setNotifications(generatedNotifications)\n        }\n      }).catch((err) => {\n        console.error('Failed to load notifications users', err)\n      })\n    }\n  }, [isOpen])\n\n  if (!isOpen) return null\n\n  const newNotifications = notifications.filter((n) => n.isNew)\n  const earlierNotifications = notifications.filter((n) => !n.isNew)\n\n  return (\n    <>\n      <div\n        className=\"notifications-overlay\"\n        onClick={closeNotifications}\n        aria-hidden=\"true\"\n      />\n      <div className=\"notifications-panel\" onClick={(e) => e.stopPropagation()}>\n        <div className=\"notifications-panel-header\">\n          <h2 className=\"notifications-panel-title\">Notifications</h2>\n        </div>\n\n        <div className=\"notifications-panel-content\">\n          {newNotifications.length > 0 && (\n            <>\n              <h3 className=\"notifications-section-title\">New</h3>\n              <div className=\"notifications-list\">\n                {newNotifications.map((notification) => (\n                  <NotificationItem\n                    key={notification.id}\n                    notification={notification}\n                  />\n                ))}\n              </div>\n            </>\n          )}\n\n          {earlierNotifications.length > 0 && (\n            <>\n              <h3 className=\"notifications-section-title\">Earlier</h3>\n              <div className=\"notifications-list\">\n                {earlierNotifications.map((notification) => (\n                  <NotificationItem\n                    key={notification.id}\n                    notification={notification}\n                  />\n                ))}\n              </div>\n            </>\n          )}\n          \n          {notifications.length === 0 && (\n             <div style={{ padding: '20px', textAlign: 'center', color: '#8e8e8e' }}>\n                No new notifications\n             </div>\n          )}\n        </div>\n      </div>\n    </>\n  )\n}\n\nfunction NotificationItem({ notification }) {\n  return (\n    <div className=\"notification-item\">\n      <div className=\"notification-avatar-container\">\n        <img \n          src={notification.user.avatar} \n          alt={notification.user.username} \n          className=\"notification-avatar\" \n        />\n      </div>\n      <div className=\"notification-info\">\n        <span className=\"notification-username\">{notification.user.username}</span>\n        {' '}{notification.text}\n        <span className=\"notification-time\">{notification.time}</span>\n      </div>\n      <div className=\"notification-action\">\n        {notification.type === 'follow' ? (\n          <button className=\"notification-action-btn\">\n            Follow\n          </button>\n        ) : (\n          <img \n            src={notification.postImage} \n            alt=\"Post thumbnail\" \n            className=\"notification-post-thumb\" \n          />\n        )}\n      </div>\n    </div>\n  )\n}\n"
        }
    ]
}